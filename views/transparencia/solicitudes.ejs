<% 
extraStyles=`
<link rel="stylesheet" href="css/sidebar.css" />
<style>
  .app-container { display: flex; min-height: 100vh; flex-direction: row; }
  .main-content { flex: 1; padding: 20px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; overflow-x: hidden; }
  .content-header { background: white; border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-left: 5px solid #7c1241; }
  .content-header h3 { color: #2c3e50; font-weight: 600; margin: 0; display: flex; align-items: center; gap: 12px; }
  .content-header .icon { background: linear-gradient(135deg, #7c1241, #9c1a5a); color: #fff; padding: 12px; border-radius: 12px; font-size: 1.2em; }
  .action-buttons { margin-top: 20px; }
  .btn-primary-custom { background: linear-gradient(135deg, #7c1241, #9c1a5a); border: none; color: #fff; padding: 12px 24px; border-radius: 25px; font-weight: 500; transition: all .3s ease; box-shadow: 0 4px 15px rgba(124,18,65,.3); }
  .btn-primary-custom:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(124,18,65,.4); color: #fff; }
  .filters-section { background: #fff; border-radius: 15px; padding: 20px; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
  .table-container { background: #fff; border-radius: 15px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: hidden; }
  .table { margin: 0; }
  .table thead th { background: #f8f9fa; border: none; color: #495057; font-weight: 600; padding: 15px 12px; text-align: center; border-bottom: 2px solid #dee2e6; }
  .table tbody td { padding: 15px 12px; vertical-align: middle; border-bottom: 1px solid #ecf0f1; text-align: center; }
  .table tbody tr:hover { background-color: #f8f9fa; transition: background-color .3s ease; }
  .btn-group .btn { margin: 0 2px; border-radius: 6px; transition: all .2s ease; }
  .btn-group .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,.15); }
  .text-truncate { max-width: 100%; display: block; }
  @media (max-width: 768px) {
    .main-content { padding: 10px; }
    .content-header, .filters-section, .table-container { padding: 15px; }
    .btn-primary-custom { width: 100%; max-width: 300px; }
    .table-responsive { font-size: .85em; }
  }
  body.modal-open { padding-right: 0 !important; }
  .modal { z-index: 1050; }
  .modal.show { display: block !important; pointer-events: auto !important; z-index: 1055 !important; }
  .modal-backdrop.show { opacity: .5 !important; pointer-events: auto !important; z-index: 1050 !important; }
  .modal-content { pointer-events: auto !important; position: relative !important; z-index: 1056 !important; border-radius: 15px; border: none; box-shadow: 0 10px 30px rgba(0,0,0,.2); }
  .modal-header { background: linear-gradient(135deg, #7c1241, #9c1a5a); color: #fff; border-radius: 15px 15px 0 0; padding: 20px 25px; }
  .modal-title { color: #fff !important; font-weight: 600; }
  .form-label { font-weight: 600; color: #2c3e50; margin-bottom: 8px; }
  .form-control { border-radius: 8px; border: 2px solid #ecf0f1; padding: 12px 15px; transition: all .3s ease; }
  .form-control:focus { border-color: #7c1241; box-shadow: 0 0 0 .2rem rgba(124,18,65,.25); }
  .form-check-input:checked { background-color: #7c1241; border-color: #7c1241; }
  .btn-close { filter: invert(1); }
  #sinSolicitudes { background-color: #f8f9fa; }
  #loadingSol .spinner-border { width: 2.5rem; height: 2.5rem; }
  .pagination .page-link { border-radius: 6px; margin: 0 2px; border: 1px solid #dee2e6; color: #7c1241; }
  .pagination .page-link:hover { background-color: #7c1241; border-color: #7c1241; color: #fff; }
  .pagination .page-item.active .page-link { background-color: #7c1241; border-color: #7c1241; color: #fff; }
  /* Stats Cards (simple) */
  .stats-card { background: #fff; border-radius: 12px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,.08); display: flex; align-items: center; gap: 12px; cursor: pointer; }
  .stats-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 1.1em; }
  .stats-info { display: flex; flex-direction: column; }
  .stats-number { font-size: 1.4em; font-weight: 700; color: #2c3e50; line-height: 1; }
  .stats-label { font-size: .8em; color: #7f8c8d; text-transform: uppercase; letter-spacing: .4px; }
</style>
`;
%>

<div class="app-container">
  <%- include('../components/sidebar', { 
    currentPage: '/transparenciaSolicitudes', 
    pageTitle: 'Solicitudes - Transparencia', 
    isAdmin: true
  }) %>

  <main class="main-content">
    <div class="content-header">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <h3>
            <i class="fas fa-paste icon"></i>
            Solicitudes - Transparencia
          </h3>
          <p class="text-muted mb-0 mt-2">Registro y gestión de solicitudes de información</p>
        </div>
        <div class="action-buttons">
          <button id="btnNuevaSolicitud" class="btn btn-primary-custom">
            <i class="fas fa-plus me-2"></i>
            Nueva solicitud
          </button>
        </div>
      </div>
    </div>

    <div class="filters-section">
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label"><i class="fas fa-search me-2"></i>Buscar</label>
          <input id="buscarSolicitud" class="form-control" placeholder="Folio, solicitante, área o descripción..." />
        </div>
        <div class="col-md-3">
          <label class="form-label"><i class="fas fa-calendar me-2"></i>Desde</label>
          <input type="date" id="fDesde" class="form-control" />
        </div>
        <div class="col-md-3">
          <label class="form-label"><i class="fas fa-calendar me-2"></i>Hasta</label>
          <input type="date" id="fHasta" class="form-control" />
        </div>
        <div class="col-md-3">
          <label class="form-label"><i class="fas fa-balance-scale me-2"></i>Recurso de revisión</label>
          <select id="filterRecursoRevision" class="form-control">
            <option value="">Todos</option>
            <option value="con">Con recurso</option>
            <option value="sin">Sin recurso</option>
          </select>
        </div>
      </div>
      <div class="d-flex justify-content-between align-items-center mt-3">
        <div class="d-flex gap-2">
          <button id="btnAplicarFiltros" class="btn btn-primary-custom btn-sm">
            <i class="fas fa-filter me-2"></i>Aplicar filtros
          </button>
          <button id="btnLimpiarFiltros" class="btn btn-outline-secondary btn-sm">
            <i class="fas fa-times me-2"></i>Limpiar
          </button>
        </div>
        <button id="btnExportarSolicitudes" class="btn btn-success btn-sm">
          <i class="fas fa-file-excel me-2"></i>Exportar
        </button>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-3 g-2">
      <div class="col-lg-3 col-md-4 col-sm-6 col-6">
  <div class="stats-card" id="cardTotal" data-estado="todos" title="Ver todas">
          <div class="stats-icon" style="background:#7c1241"><i class="fas fa-list"></i></div>
          <div class="stats-info">
            <span class="stats-number" id="totalSolicitudes">-</span>
            <span class="stats-label">Total</span>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-4 col-sm-6 col-6">
  <div class="stats-card" id="cardConRecurso" data-estado="conRecurso" title="Ver con recurso">
          <div class="stats-icon" style="background:#2ecc71"><i class="fas fa-undo-alt"></i></div>
          <div class="stats-info">
            <span class="stats-number" id="conRecurso">-</span>
            <span class="stats-label">Con recurso</span>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-4 col-sm-6 col-6">
  <div class="stats-card" id="cardPorVencer" data-estado="porVencer5" title="Ver ≤ 5 días sin cumplir">
          <div class="stats-icon" style="background:#f39c12"><i class="fas fa-hourglass-half"></i></div>
          <div class="stats-info">
            <span class="stats-number" id="porVencer5">-</span>
            <span class="stats-label">≤ 5 días sin cumplir</span>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-4 col-sm-6 col-6">
  <div class="stats-card" id="cardVencidas" data-estado="vencidas" title="Ver vencidas sin cumplir">
          <div class="stats-icon" style="background:#e74c3c"><i class="fas fa-exclamation-triangle"></i></div>
          <div class="stats-info">
            <span class="stats-number" id="vencidasSinCumplir">-</span>
            <span class="stats-label">Vencidas sin cumplir</span>
          </div>
        </div>
      </div>
    </div>

    <div class="table-container">
      <div id="loadingSol" class="text-center py-4" style="display:none">
        <div class="spinner-border text-secondary" role="status"></div>
      </div>
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th class="text-center">Folio</th>
              <th class="text-center">Recepción</th>
              <th class="text-center">Medio</th>
              <th>Solicitante</th>
              <th>Área responsable</th>
              <th class="text-center">Límite respuesta</th>
              <th class="text-center">Acciones</th>
            </tr>
          </thead>
          <tbody id="tablaSolicitudes"></tbody>
        </table>
      </div>
      <div class="d-flex justify-content-between align-items-center mt-3">
        <div class="d-flex align-items-center gap-2">
          <span class="text-muted small">Mostrando</span>
          <select id="limitSelect" class="form-select form-select-sm" style="width: auto;">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
          <span class="text-muted small">registros por página</span>
        </div>
        <nav aria-label="Paginación de solicitudes">
          <ul class="pagination pagination-sm mb-0" id="pagination"></ul>
        </nav>
      </div>
      <div id="sinSolicitudes" class="text-center py-4 text-muted" style="display:none">Sin registros</div>
    </div>

    <!-- Modal Solicitud -->
    <div class="modal fade" id="modalSolicitud" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="tituloModalSolicitud">Nueva solicitud</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form id="formSolicitud">
            <div class="modal-body">
              <div class="row g-3">
                <div class="col-md-4">
                  <label class="form-label">Folio</label>
                  <input type="text" name="folio" id="folio" class="form-control" required />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Fecha recepción</label>
                  <input type="date" name="fechaRecepcion" id="fechaRecepcion" class="form-control" required />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Medio recepción</label>
                  <input type="text" name="medioRecepcion" id="medioRecepcion" class="form-control" required />
                </div>

                <div class="col-md-6">
                  <label class="form-label">Nombre solicitante</label>
                  <input type="text" name="solicitanteNombre" id="solicitanteNombre" class="form-control" required />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Área responsable</label>
                  <input type="text" name="areaResponsable" id="areaResponsable" class="form-control" required />
                </div>

                <div class="col-12">
                  <label class="form-label">Descripción de la solicitud</label>
                  <textarea name="descripcionSolicitud" id="descripcionSolicitud" class="form-control" rows="3" required></textarea>
                </div>

                <div class="col-md-4">
                  <label class="form-label">Fecha de asignación</label>
                  <input type="date" name="fechaAsignacion" id="fechaAsignacion" class="form-control" />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Fecha límite para responder</label>
                  <input type="date" name="fechaLimiteRespuesta" id="fechaLimiteRespuesta" class="form-control" />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Fecha cumplimiento de plazo</label>
                  <input type="date" name="fechaCumplimiento" id="fechaCumplimiento" class="form-control" />
                </div>

                <div class="col-md-6">
                  <div class="form-check mt-4">
                    <input class="form-check-input" type="checkbox" id="satisfaccionCliente" name="satisfaccionCliente" />
                    <label class="form-check-label" for="satisfaccionCliente">Satisfacción del cliente</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-check mt-4">
                    <input class="form-check-input" type="checkbox" id="recursoRevision" name="recursoRevision" />
                    <label class="form-check-label" for="recursoRevision">Recurso de revisión</label>
                  </div>
                </div>

                <div class="col-12">
                  <label class="form-label">Observaciones</label>
                  <textarea name="observaciones" id="observaciones" class="form-control" rows="3"></textarea>
                </div>

                <div class="col-12">
                  <label class="form-label">Archivos (opcional)</label>
                  <input type="file" name="archivos" id="archivos" class="form-control" multiple />
                  <div id="archivoActualContainer" class="mt-2" style="display: none;">
                    <label class="form-label mt-3">Archivos actuales:</label>
                    <div id="listaArchivosActuales" class="d-flex flex-wrap gap-2 mt-1"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-primary-custom">Guardar</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </main>
</div>

<script src="js/components/sidebar.js"></script>
<% extraScripts=` 
<script src="/js/transparencia/solicitudes.js"></script>
`; %>
